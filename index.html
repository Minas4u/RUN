<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helios Running Team - Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        input[type="text"]:focus, input[type="number"]:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
        }
        input#lt2speed:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        input#baseKilometers:focus, input#totalWeeks:focus, input#kPercentage:focus {
            border-color: #16a34a;
            box-shadow: 0 0 0 3px rgba(22, 163, 74, 0.5);
        }
        .result-item {
            background-color: #e5e7eb;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }
        .result-item strong {
             font-weight: 600;
        }
        .plan-result-item {
            background-color: #e0e7ff;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .plan-result-item .low-high-values strong {
            font-weight: 600;
        }
        .data-table {
            width: 100%;
            margin-top: 0.5rem;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .data-table th, .data-table td {
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            text-align: left;
        }
        .data-table th {
            font-weight: 600;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 py-8">
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl w-full max-w-3xl">
        <header class="mb-6 sm:mb-8 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Helios Running Team</h1>
            <p class="text-gray-600 mt-2">Calculate your running training zones & mileage.</p>
        </header>

        <div class="mb-6">
            <label for="lt2speed" class="block text-sm font-medium text-gray-700 mb-1">Enter LT2 Speed:</label>
            <input type="text" id="lt2speed" name="lt2speed" placeholder="e.g., 4:30"
                   class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm sm:text-sm transition duration-150 ease-in-out">
            <div id="error-message" class="text-red-500 text-sm mt-2 h-5"></div>
        </div>

        <button onclick="calculatePaces()"
                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition duration-150 ease-in-out transform hover:scale-105">
            Calculate Zones & Repeats Paces
        </button>

        <div class="mt-8 md:flex md:space-x-6">
            <div id="zones-section" class="flex-1">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-2 border-b pb-2">Training Zones:</h2>
                <div id="zones-content">
                     <p class="text-gray-500 italic">Enter your LT2 speed and click calculate to see your zones.</p>
                </div>
            </div>

            <div id="repeats-section" class="flex-1 mt-8 md:mt-0">
                <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-2 border-b pb-2">Repeats:</h2>
                <div id="repeats-content">
                     <p class="text-gray-500 italic">Calculated based on your LT2 speed.</p>
                </div>
            </div>
        </div>

        <div class="mt-12 pt-8 border-t border-gray-300">
            <header class="mb-6 text-center">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">Mileage</h2>
            </header>

            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <div>
                    <label for="baseKilometers" class="block text-sm font-medium text-gray-700 mb-1">Base Kilometers:</label>
                    <input type="number" id="baseKilometers" name="baseKilometers" placeholder="e.g., 20" min="0.1" step="0.1"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm sm:text-sm transition duration-150 ease-in-out">
                </div>
                <div>
                    <label for="totalWeeks" class="block text-sm font-medium text-gray-700 mb-1">Total Weeks:</label>
                    <input type="number" id="totalWeeks" name="totalWeeks" placeholder="e.g., 12" min="1" step="1"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm sm:text-sm transition duration-150 ease-in-out">
                </div>
                <div>
                    <label for="kPercentage" class="block text-sm font-medium text-gray-700 mb-1">K (% increase):</label>
                    <input type="number" id="kPercentage" name="kPercentage" placeholder="e.g., 10" min="0" step="1"
                           class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm sm:text-sm transition duration-150 ease-in-out">
                </div>
            </div>
            <div id="plan-error-message" class="text-red-500 text-sm mb-4 h-5"></div>
            <button onclick="calculateWeeklyPlan()"
                    class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out transform hover:scale-105">
                Calculate Weekly Plan
            </button>

            <div id="planResults" class="mt-8">
                <h3 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">Your Plan:</h3>
                <div id="plan-results-content" class="space-y-1 text-sm max-h-60 overflow-y-auto">
                     <p class="text-gray-500 italic">Enter details above and click calculate to see your weekly plan.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function parsePaceToSeconds(paceString) {
            if (!paceString || typeof paceString !== 'string') return NaN;
            const parts = paceString.trim().split(':');
            if (parts.length !== 2) return NaN;
            const minutes = parseInt(parts[0], 10);
            const seconds = parseInt(parts[1], 10);
            if (isNaN(minutes) || isNaN(seconds) || minutes < 0 || seconds < 0 || seconds >= 60) return NaN;
            return (minutes * 60) + seconds;
        }

        function formatSecondsToPace(totalSeconds) {
            if (isNaN(totalSeconds) || totalSeconds < 0) return "N/A";
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = Math.round(totalSeconds % 60);
            return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function calculatePaces() {
            const lt2SpeedInput = document.getElementById('lt2speed').value;
            const zonesContentDiv = document.getElementById('zones-content');
            const repeatsContentDiv = document.getElementById('repeats-content');
            const errorMessageDiv = document.getElementById('error-message');

            zonesContentDiv.innerHTML = '<p class="text-gray-500 italic">Calculating...</p>';
            repeatsContentDiv.innerHTML = '<p class="text-gray-500 italic">Calculating...</p>';
            errorMessageDiv.textContent = '';

            const lt2SpeedInSeconds = parsePaceToSeconds(lt2SpeedInput);

            if (isNaN(lt2SpeedInSeconds) || lt2SpeedInSeconds <= 0) {
                errorMessageDiv.textContent = 'Invalid LT2 speed. Use mm:ss format (e.g., 4:30). Pace must be positive.';
                zonesContentDiv.innerHTML = '<p class="text-red-500 italic">Could not calculate zones due to invalid input.</p>';
                repeatsContentDiv.innerHTML = '<p class="text-red-500 italic">Could not calculate repeats paces due to invalid LT2 input.</p>';
                return;
            }

            const zonesData = [
                { name: "Zone 1", descriptor: "Easy", lowPercent: 60, highPercent: 75, colorClass: "text-green-500" },
                { name: "Zone 2", descriptor: "Base", lowPercent: 76, highPercent: 86, colorClass: "text-blue-500" },
                { name: "Zone 3", descriptor: "Aerobic", lowPercent: 87, highPercent: 99, colorClass: "text-green-700" },
                { name: "Zone 4", descriptor: "Threshold", lowPercent: 100, highPercent: 115, colorClass: "text-amber-500" },
                { name: "Zone 5", descriptor: "Max", lowPercent: 116, highPercent: 145, colorClass: "text-red-600" }
            ];
            const racePaceInfo = { name: "Race Pace", descriptor: "", lowPercent: 90, highPercent: 92, colorClass: "text-purple-600" };

            zonesContentDiv.innerHTML = '';
            const zonesTable = document.createElement('table');
            zonesTable.classList.add('data-table');
            const zonesThead = zonesTable.createTHead();
            zonesThead.innerHTML = `<tr>
                                      <th class="bg-gray-100">Zone</th>
                                      <th class="bg-gray-100">Pace Range</th>
                                    </tr>`;
            const zonesTbody = zonesTable.createTBody();

            [...zonesData, racePaceInfo].forEach(zone => {
                const fasterPaceSeconds = lt2SpeedInSeconds / (zone.highPercent / 100);
                const slowerPaceSeconds = lt2SpeedInSeconds / (zone.lowPercent / 100);
                
                const row = zonesTbody.insertRow();
                const cellName = row.insertCell();
                cellName.innerHTML = `<strong class="${zone.colorClass}">${zone.name} ${zone.descriptor ? '['+zone.descriptor+']' : ''}</strong>`;
                
                const cellPace = row.insertCell();
                cellPace.textContent = `${formatSecondsToPace(slowerPaceSeconds)} - ${formatSecondsToPace(fasterPaceSeconds)}`;
            });
            zonesContentDiv.appendChild(zonesTable);

            const repeatDistances = [
                { distance: "1000m", lowPercent: 99, highPercent: 101 },
                { distance: "800m",  lowPercent: 101, highPercent: 102 },
                { distance: "400m",  lowPercent: 104, highPercent: 106 },
                { distance: "300m",  lowPercent: 110, highPercent: 112 }
            ];

            repeatsContentDiv.innerHTML = '';

            const repeatsTable = document.createElement('table');
            repeatsTable.id = 'repeats-table';
            repeatsTable.classList.add('data-table');

            const repeatsThead = repeatsTable.createTHead();
            repeatsThead.innerHTML = `<tr>
                                 <th class="bg-blue-100">Distance</th>
                                 <th class="bg-blue-100">Target Time for Distance</th>
                               </tr>`;
            
            const repeatsTbody = repeatsTable.createTBody();
            repeatDistances.forEach(item => {
                const fasterPaceTotalSeconds = lt2SpeedInSeconds / (item.highPercent / 100);
                const slowerPaceTotalSeconds = lt2SpeedInSeconds / (item.lowPercent / 100);

                let distanceMultiplier = 1; 
                if (item.distance === "800m") distanceMultiplier = 0.8;
                else if (item.distance === "400m") distanceMultiplier = 0.4;
                else if (item.distance === "300m") distanceMultiplier = 0.3;

                const fasterTimeForDistance = fasterPaceTotalSeconds * distanceMultiplier;
                const slowerTimeForDistance = slowerPaceTotalSeconds * distanceMultiplier;

                const row = repeatsTbody.insertRow();
                const cellDistance = row.insertCell();
                cellDistance.textContent = item.distance;
                cellDistance.classList.add('font-medium');

                const cellPace = row.insertCell();
                cellPace.textContent = `${formatSecondsToPace(slowerTimeForDistance)} - ${formatSecondsToPace(fasterTimeForDistance)}`;
            });
            repeatsContentDiv.appendChild(repeatsTable);
        }

        document.getElementById('lt2speed').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                calculatePaces();
            }
        });

        function calculateWeeklyPlan() {
            const baseKmInput = document.getElementById('baseKilometers').value;
            const totalWeeksInput = document.getElementById('totalWeeks').value;
            const kPercentInput = document.getElementById('kPercentage').value;

            const planResultsContentDiv = document.getElementById('plan-results-content');
            const planErrorMessageDiv = document.getElementById('plan-error-message');

            planResultsContentDiv.innerHTML = '<p class="text-gray-500 italic">Calculating plan...</p>';
            planErrorMessageDiv.textContent = '';

            const baseKm = parseFloat(baseKmInput);
            const totalWeeks = parseInt(totalWeeksInput, 10);
            const kPercent = parseFloat(kPercentInput);

            let errors = [];
            if (isNaN(baseKm) || baseKm <= 0) errors.push("Base Kilometers must be a positive number.");
            if (isNaN(totalWeeks) || totalWeeks <= 0 || !Number.isInteger(totalWeeks)) errors.push("Total Weeks must be a positive integer.");
            if (isNaN(kPercent) || kPercent < 0) errors.push("K Percentage must be a non-negative number.");

            if (errors.length > 0) {
                planErrorMessageDiv.textContent = errors.join(' ');
                planResultsContentDiv.innerHTML = `<p class="text-red-500 italic">Could not calculate plan due to invalid input(s).</p>`;
                return;
            }
            
            if (totalWeeks > 200) { 
                 planErrorMessageDiv.textContent = "Plans over 200 weeks are not supported to prevent browser slowdown.";
                 planResultsContentDiv.innerHTML = `<p class="text-red-500 italic">Plan too long.</p>`;
                 return;
            }

            const weeklyKms = []; 
            if (totalWeeks === 0) { 
                planResultsContentDiv.innerHTML = '<p class="text-gray-500 italic">Please enter a valid number of weeks.</p>';
                return;
            }

            weeklyKms[0] = baseKm; 

            for (let i = 1; i < totalWeeks; i++) { 
                const currentWeekNumber = i + 1; 
                const kmFromPreviousWeek = weeklyKms[i-1]; 
                const weekInFiveCycle = (currentWeekNumber - 1) % 5;

                if (weekInFiveCycle === 4) { 
                    if (i >=2) { 
                        weeklyKms[i] = weeklyKms[i-2];
                    } else { 
                        weeklyKms[i] = kmFromPreviousWeek * (1 + kPercent / 100); 
                    }
                } else if (weekInFiveCycle === 3) { 
                    weeklyKms[i] = kmFromPreviousWeek * (1 - (5 * kPercent) / 100);
                } else { 
                    weeklyKms[i] = kmFromPreviousWeek * (1 + kPercent / 100);
                }
                if (weeklyKms[i] < 0) weeklyKms[i] = 0;
            }

            planResultsContentDiv.innerHTML = ''; 
            if (weeklyKms.length === 0 && totalWeeks > 0) { 
                 planResultsContentDiv.innerHTML = '<p class="text-red-500 italic">An error occurred calculating the plan.</p>';
                 return;
            }

            weeklyKms.forEach((km, index) => {
                const weekNumber = index + 1; 
                const mainKmFormatted = km.toFixed(0); 
                const lowKm = (km * 0.80).toFixed(0);   
                const highKm = (km * 0.20).toFixed(0);  

                const p = document.createElement('p');
                p.classList.add('plan-result-item');
                
                const mainKmSpan = document.createElement('span');
                mainKmSpan.classList.add('font-medium'); 
                mainKmSpan.textContent = `Week ${weekNumber}: ${mainKmFormatted} km`;

                const lowHighSpan = document.createElement('span');
                lowHighSpan.classList.add('low-high-values'); 
                lowHighSpan.innerHTML = `<strong class="text-blue-500">Low: ${lowKm}</strong> <strong class="text-orange-500 ml-2">High: ${highKm}</strong>`;
                
                p.appendChild(mainKmSpan);
                p.appendChild(lowHighSpan);
                planResultsContentDiv.appendChild(p);
            });
        }

        ['baseKilometers', 'totalWeeks', 'kPercentage'].forEach(id => {
            document.getElementById(id).addEventListener('keypress', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); 
                    calculateWeeklyPlan();
                }
            });
        });
    </script>
</body>
</html>
