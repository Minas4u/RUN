<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RNApace</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        .container {
            max-width: 580px; /* Slightly reduced max-width */
            margin: 25px auto; /* Adjusted margin */
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .input-group, .mode-selection-group {
            margin-bottom: 16px; /* Adjusted margin */
        }
        /* Remove margin for the mode selection if it has no visible label */
        .mode-selection-group.no-label {
            margin-bottom: 12px; /* Further reduce if no explicit label text */
        }
        .input-group label, .mode-selection-group label {
            display: block;
            margin-bottom: 4px; /* Adjusted margin */
            font-weight: 500;
            color: #374151; /* Tailwind gray-700 */
        }
        .input-group input, .input-group select, .mode-selection-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db; /* Tailwind gray-300 */
            border-radius: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        .input-group input:focus, .input-group select:focus, .mode-selection-group select:focus {
            outline: none;
            border-color: #6366f1; /* Tailwind indigo-500 */
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }
        .time-inputs, .pace-inputs {
            display: flex;
            gap: 10px;
        }
        .time-inputs input, .pace-inputs input {
            text-align: center;
        }
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px; /* Adjusted margin */
        }
        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .button-primary {
            background-color: #6366f1; /* Tailwind indigo-500 */
            color: white;
        }
        .button-primary:hover {
            background-color: #4f46e5; /* Tailwind indigo-600 */
        }
        .button-secondary {
            background-color: #e5e7eb; /* Tailwind gray-200 */
            color: #374151; /* Tailwind gray-700 */
        }
        .button-secondary:hover {
            background-color: #d1d5db; /* Tailwind gray-300 */
        }
        .result-area {
            margin-top: 20px;
            padding: 15px;
            background-color: #eef2ff; /* Tailwind indigo-50 */
            border: 1px solid #c7d2fe; /* Tailwind indigo-200 */
            border-radius: 8px;
            text-align: center;
            font-size: 1.1rem;
            color: #3730a3; /* Tailwind indigo-800 */
        }
        .result-area p {
            margin: 0;
        }
        .error-message {
            color: #ef4444; /* Tailwind red-500 */
            font-size: 0.85rem;
            margin-top: 4px;
            min-height: 1.2em;
        }
        /* Responsive adjustments */
        @media (max-width: 480px) {
            .time-inputs, .pace-inputs {
                flex-direction: column;
            }
            .button-group {
                flex-direction: column;
            }
            .button {
                width: 100%;
            }
            .container {
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">RNApace</h1>

        <div class="mode-selection-group no-label">
            <select id="calculationMode" aria-label="Calculation Mode">
                <option value="pace">Pace</option> <option value="time">Time</option> <option value="distance">Distance</option> </select>
        </div>

        <div class="input-group">
            <label for="distance">Distance</label>
            <div class="flex items-center gap-2">
                <input type="number" id="distance" placeholder="e.g., 10 or 5000" class="flex-grow">
                <select id="distanceUnit" class="w-1/3">
                    <option value="km">km</option>
                    <option value="m">m</option>
                </select>
            </div>
            <p id="distanceError" class="error-message"></p>
        </div>

        <div class="input-group">
            <label for="hours">Time</label>
            <div class="time-inputs">
                <input type="number" id="hours" placeholder="HH" min="0" aria-label="Hours">
                <input type="number" id="minutes" placeholder="MM" min="0" max="59" aria-label="Minutes">
                <input type="number" id="seconds" placeholder="SS" min="0" max="59" aria-label="Seconds">
            </div>
            <p id="timeError" class="error-message"></p>
        </div>

        <div class="input-group">
            <label for="paceMinutes">Pace</label>
            <div class="pace-inputs">
                <input type="number" id="paceMinutes" placeholder="MM" min="0" aria-label="Pace Minutes">
                <input type="number" id="paceSeconds" placeholder="SS" min="0" max="59" aria-label="Pace Seconds">
            </div>
            <p id="paceError" class="error-message"></p>
        </div>

        <div class="button-group">
            <button id="clearButton" class="button button-secondary">Clear</button>
            <button id="calculateButton" class="button button-primary">Calculate</button>
        </div>

        <div id="resultArea" class="result-area" style="display: none;">
            <p id="resultText"></p>
        </div>
    </div>

    <script>
        // DOM Elements
        const calculationModeSelect = document.getElementById('calculationMode');
        const distanceInput = document.getElementById('distance');
        const distanceUnitSelect = document.getElementById('distanceUnit');
        const hoursInput = document.getElementById('hours');
        const minutesInput = document.getElementById('minutes');
        const secondsInput = document.getElementById('seconds');
        const paceMinutesInput = document.getElementById('paceMinutes');
        const paceSecondsInput = document.getElementById('paceSeconds');
        const calculateButton = document.getElementById('calculateButton');
        const clearButton = document.getElementById('clearButton');
        const resultArea = document.getElementById('resultArea');
        const resultText = document.getElementById('resultText');
        const distanceError = document.getElementById('distanceError');
        const timeError = document.getElementById('timeError');
        const paceError = document.getElementById('paceError');

        // --- Event Listeners ---
        calculateButton.addEventListener('click', handleCalculation);
        clearButton.addEventListener('click', clearAllFields);
        calculationModeSelect.addEventListener('change', handleModeChange);

        // Initial setup
        handleModeChange(); // Set initial input field states

        // --- Functions ---

        /**
         * Handles changes in the calculation mode.
         * Disables/enables input fields based on the selected mode.
         */
        function handleModeChange() {
            const mode = calculationModeSelect.value;
            clearErrors(); 

            distanceInput.disabled = false;
            distanceUnitSelect.disabled = false; 
            hoursInput.disabled = false;
            minutesInput.disabled = false;
            secondsInput.disabled = false;
            paceMinutesInput.disabled = false;
            paceSecondsInput.disabled = false;

            if (mode === 'pace') {
                paceMinutesInput.disabled = true;
                paceSecondsInput.disabled = true;
            } else if (mode === 'time') {
                hoursInput.disabled = true;
                minutesInput.disabled = true;
                secondsInput.disabled = true;
            } else if (mode === 'distance') {
                distanceInput.disabled = true;
            }
        }


        /**
         * Validates a single numeric input field.
         * @param {HTMLInputElement} inputElement - The input element.
         * @param {string} fieldName - Name of the field for error messages.
         * @param {number} min - Minimum allowed value.
         * @param {number} max - Maximum allowed value.
         * @param {boolean} allowZero - Whether zero is an allowed value.
         * @returns {number|object} - The parsed value if valid, or an object with an error message.
         */
        function validateNumericInput(inputElement, fieldName, min, max, allowZero = false) {
            const valueStr = inputElement.value.trim();
            if (valueStr === '') return { error: `${fieldName} is required.`}; 

            const value = parseFloat(valueStr);
            if (isNaN(value)) {
                return { error: `${fieldName} must be a valid number.` };
            }
            if (!allowZero && value <= 0) {
                 if (value < min || value > max) { 
                    return { error: `${fieldName} must be between ${min} and ${max}.` };
                 }
                 return { error: `${fieldName} must be greater than 0.` };
            }
             if (value < min || value > max) {
                return { error: `${fieldName} must be between ${min} and ${max}.` };
            }
            return value; 
        }


        /**
         * Validates all inputs based on the current calculation mode.
         * @returns {object|null} - An object with parsed values if valid, or null if validation fails.
         */
        function validateAllInputs() {
            clearErrors();
            const mode = calculationModeSelect.value;
            let isValid = true;
            const values = {};

            // --- Validate Distance ---
            if (mode === 'pace' || mode === 'time') {
                const distValidationResult = validateNumericInput(distanceInput, 'Distance', 0.01, 10000);
                if (typeof distValidationResult === 'object' && distValidationResult.error) {
                    distanceError.textContent = distValidationResult.error;
                    isValid = false;
                } else {
                    values.distance = distValidationResult;
                }
                values.distanceUnit = distanceUnitSelect.value;
            }

            // --- Validate Time ---
            if (mode === 'pace' || mode === 'distance') {
                const hStr = hoursInput.value.trim();
                const mStr = minutesInput.value.trim();
                const sStr = secondsInput.value.trim();

                const h = hStr === '' ? 0 : parseInt(hStr);
                const m = mStr === '' ? 0 : parseInt(mStr);
                const s = sStr === '' ? 0 : parseInt(sStr);

                if ( (hStr !== '' && isNaN(h)) || (mStr !== '' && isNaN(m)) || (sStr !== '' && isNaN(s)) ||
                     h < 0 || m < 0 || m > 59 || s < 0 || s > 59 || h > 99 ) {
                    timeError.textContent = 'Valid HH (0-99), MM (0-59), SS (0-59) required.';
                    isValid = false;
                } else if (h === 0 && m === 0 && s === 0 && (hStr || mStr || sStr)) { 
                     timeError.textContent = 'Total time must be greater than zero if entered.';
                     isValid = false;
                } else if (!hStr && !mStr && !sStr) { 
                    timeError.textContent = 'Time is required.';
                    isValid = false;
                }
                values.totalTimeInSeconds = (h * 3600) + (m * 60) + s;
                if (values.totalTimeInSeconds <= 0 && (hStr || mStr || sStr) ) { 
                    timeError.textContent = 'Total time must be greater than zero.';
                    isValid = false;
                }
            }

            // --- Validate Pace ---
            if (mode === 'time' || mode === 'distance') {
                const pmStr = paceMinutesInput.value.trim();
                const psStr = paceSecondsInput.value.trim();

                const pm = pmStr === '' ? 0 : parseInt(pmStr);
                const ps = psStr === '' ? 0 : parseInt(psStr);

                if ( (pmStr !== '' && isNaN(pm)) || (psStr !== '' && isNaN(ps)) ||
                     pm < 0 || ps < 0 || ps > 59 || pm > 599 ) { 
                    paceError.textContent = 'Valid Pace MM (0-599), SS (0-59) required.';
                    isValid = false;
                } else if (pm === 0 && ps === 0 && (pmStr || psStr) ) {
                    paceError.textContent = 'Pace must be greater than zero if entered.';
                    isValid = false;
                } else if (!pmStr && !psStr) { 
                    paceError.textContent = 'Pace is required.';
                    isValid = false;
                }
                values.paceInSecondsPerUnit = (pm * 60) + ps;
                 if (values.paceInSecondsPerUnit <= 0 && (pmStr || psStr) ) { 
                    paceError.textContent = 'Pace must be greater than zero.';
                    isValid = false;
                }
            }
            return isValid ? values : null;
        }

        /**
         * Formats total seconds into HH:MM:SS string.
         */
        function formatTime(totalSeconds) {
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = Math.round(totalSeconds % 60); 
            return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        /**
         * Formats pace (seconds per unit) into MM:SS string.
         */
        function formatPace(secondsPerUnit) {
            const m = Math.floor(secondsPerUnit / 60);
            const s = Math.round(secondsPerUnit % 60); 
            return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }


        /**
         * Handles the primary calculation logic based on the selected mode.
         */
        function handleCalculation() {
            const validatedInputs = validateAllInputs();
            if (!validatedInputs) {
                resultArea.style.display = 'none';
                return;
            }

            const mode = calculationModeSelect.value;
            const unit = distanceUnitSelect.value;
            let resultString = '';

            try {
                if (mode === 'pace') {
                    if (validatedInputs.distance === 0) { 
                        distanceError.textContent = "Distance cannot be zero for pace calculation.";
                        resultArea.style.display = 'none'; return;
                    }
                    const paceSecPerUnit = validatedInputs.totalTimeInSeconds / validatedInputs.distance;
                    if (!isFinite(paceSecPerUnit) || paceSecPerUnit <= 0) throw new Error("Calculated pace is invalid (e.g., zero or negative).");
                    resultString = `Pace: ${formatPace(paceSecPerUnit)} per ${unit}`;
                    paceMinutesInput.value = String(Math.floor(paceSecPerUnit / 60)).padStart(2, '0');
                    paceSecondsInput.value = String(Math.round(paceSecPerUnit % 60)).padStart(2, '0');

                } else if (mode === 'time') {
                     if (validatedInputs.distance === 0) { 
                        distanceError.textContent = "Distance cannot be zero for time calculation.";
                        resultArea.style.display = 'none'; return;
                    }
                    const totalSeconds = validatedInputs.paceInSecondsPerUnit * validatedInputs.distance;
                    if (!isFinite(totalSeconds) || totalSeconds <= 0) throw new Error("Calculated time is invalid (e.g., zero or negative).");
                    resultString = `Time: ${formatTime(totalSeconds)}`;
                    hoursInput.value = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                    minutesInput.value = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                    secondsInput.value = String(Math.round(totalSeconds % 60)).padStart(2, '0');

                } else if (mode === 'distance') {
                    if (validatedInputs.paceInSecondsPerUnit === 0) {
                         paceError.textContent = 'Pace cannot be zero for distance calculation.';
                         resultArea.style.display = 'none';
                         return;
                    }
                    const calculatedDistance = validatedInputs.totalTimeInSeconds / validatedInputs.paceInSecondsPerUnit;
                    if (!isFinite(calculatedDistance) || calculatedDistance <= 0) throw new Error("Calculated distance is invalid (e.g., zero or negative).");
                    resultString = `Distance: ${calculatedDistance.toFixed(2)} ${unit}`;
                    distanceInput.value = calculatedDistance.toFixed(2);
                }

                resultText.textContent = resultString;
                resultArea.style.display = 'block';

            } catch (error) {
                resultText.textContent = `Error: ${error.message || 'Could not perform calculation.'}`;
                resultArea.style.display = 'block';
                if (mode === 'pace' && !timeError.textContent && !distanceError.textContent) timeError.textContent = "Check time/distance inputs.";
                else if (mode === 'time' && !paceError.textContent && !distanceError.textContent) paceError.textContent = "Check pace/distance inputs.";
                else if (mode === 'distance' && !timeError.textContent && !paceError.textContent) timeError.textContent = "Check time/pace inputs.";
            }
        }

        /**
         * Clears all error messages.
         */
        function clearErrors() {
            distanceError.textContent = '';
            timeError.textContent = '';
            paceError.textContent = '';
        }

        /**
         * Clears all input fields, results, and errors. Resets mode.
         */
        function clearAllFields() {
            distanceInput.value = '';
            hoursInput.value = '';
            minutesInput.value = '';
            secondsInput.value = '';
            paceMinutesInput.value = '';
            paceSecondsInput.value = '';

            distanceUnitSelect.value = 'km'; 
            calculationModeSelect.value = 'pace'; 

            handleModeChange(); 

            resultArea.style.display = 'none';
            resultText.textContent = '';
            clearErrors();
        }

        // Initial call to set things up
        clearAllFields(); 
    </script>
</body>
</html>
